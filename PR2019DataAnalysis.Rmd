---
title: "Puerto Rico 2019 Soil and Root Analyses by Depth"
output:
  html_document:
    df_print: paged
    toc: true
    toc_float:
      collapsed: TRUE
      smooth_scroll: no
  pdf_document:
    toc: yes
  fig_caption: yes
  tab_caption: yes
---

# Introduction
The current model includes roots and 10 soil layers (as defined by hydrological models ) up to 3 m. However, the behavior of roots within those layers and how they regulate P acquisition is not well constrained. One study found (citation?) that root phosphatase decreased with depth but actually increased by depth when root phosphatase is expressed per root length. Measuring root physical and physiological traits along a defined soil profile will enable a more complete understanding of root interactions with soil phosphorus availability across depths, providing data needed to parameterize the phosphorus model.  

# Methods

## Sample Collection and Processing
On February 22nd - February 24th, 2019 we collected three soil cores per site up to a meter for soil phosphatase and bulk density. Soil phosphatase cores will also be processed for resin P and root biomass. Bulk density samples will also be processed for total P and organic P. We collected soil phosphatase cores using a 30 cm split core with a hammer and collected bulk density cores using a kit. We also collected a 30 cm core for paired root and soil phosphatase.

We returned 2/26/2019 and samples were to arrive on 2/27/2019. However, they arrived late on 2/28/2019.

**Root and soil phosphatase: 2/28/2019 - 03/02/2019**

Root and soil phosphatase was measured using a modified para-nitrophenyl phosphatase method. Approximately 0.5 g fresh wt of roots in 9 mls of 50 mM sodium acetate-acetic acid buffer was incubated for 1 hr in 200 rpm at 27 $^\circ$C. Absorbance of the solution when terminated with 0.11 M NaOH was read at 400 nm and compared to a blank. Soil phosphatase was measured in a similar process except 1.0 g fresh soil was used with modified universal buffer. In addition, soil samples were terminated with 0.5 M NaOH and 0.5 M CaCl2.

**Mycorrhizae: 2/28/2019 - 03/01/2019**

**Bulk density: 2/28/2019 - 03/03/2019**
Bulk density samples were collected using a kit from AMR to ensure consistency. The diameter of each metal rings containing the soil was (**2.54 cm??**). Soil was removed from the metal rings and deposited into bulk density bags and oven dried at (110 $^\circ$C).

**Resin P: 03/01/2019 - 03/04/2019**
Resin P was measuring using anion exchange membrane strips charged with sodium bicarbonate. Approximately 8 g fresh wt of soil and five strips were added to a sample cups with 80 mls diH2O and shaken vigorously (rpm) for 24 hours. Membrane strips were removed and washed with diH2O prior to shaking them with 50 ml of 0.25 M H2SO4 for 1 hr at lower speed. Phosphate concentration was measuring using the Lachat Quikchem.

**Root picking for root biomass: 03/10/2019 - 03/26/2019**
Roots from each depth: 0-5 cm, 7-12 cm, 12-14cm, 20-26cm, 33-47cm, and 58-88cm were picked for both transportive (> 1 mm diameter) and absorptive (< 1 mm diameter) roots.

**Organic P: 4/15/2019 - 4/19/2019**
Total soil organic phosphorus was measured using the Bowman extraction method, modified in Condron 1990. Briefly, 2 g of fresh soil was measured into a 50 ml falcon tube prior to adding 3 ml of 18 M H2SO4 added 1 ml at a time. 4 mls of diH2O was added in 1 ml increments followed by 48 mls of diH2O. Samples were vortexed in between each addition to ensure complete contact between acid, water, and soil. Samples were centrifuged then filtered. The filter was saved and added to the soil following the acid extraction for hte alkali extraction. Both the filter and the soil was shaken with 98 ml of 0.5 M NaOH for 2 hours. After centrifuging and filtering, both the acid extract and the alkali extract were read using the Lachat.
**EVR organic P analysis needs to be redone**

## Statistical analysis
For consistency, data are rank transformed prior to using two-way ANOVAs to discern differences among sites and depth.

## To-do list

- graph organic p (& resin p) x sand:silt:clay
- combine depths to use for paired root&soil phosphatase and re-analyze
- multifactor analysis for soil phosphatase instead of pca
- fix depths so that they're consistent between graphs

```{r global_options, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
```

```{r Packages}
library(tidyverse)
library(car)
library(reshape2)
library(plotrix)
library(knitr)
library(factoextra)
library(naniar)
library(ggpubr)
library(agricolae)
```

```{r MasterSheet}
mastersheet <- read.csv("~/Documents/Stats/PR2019/Mastersheet.csv", header = TRUE, stringsAsFactors = TRUE, na.strings = "NA")
View(mastersheet)
```

```{r Datasets}
soilpase <- read.csv("~/Documents/Stats/PR2019/SoilPase.csv", header = TRUE, na.strings = "NA", stringsAsFactors = TRUE)
pairedpase <- read.csv("~/Documents/Stats/PR2019/ShortCore.csv", header = TRUE, na.strings = "NA", stringsAsFactors = TRUE)
resinp <- read.csv("~/Documents/Stats/PR2019/PR2019_resinp.csv", header = TRUE, na.strings = "NA", stringsAsFactors = TRUE) %>% 
  replace_with_na(replace = list(ResinP = 5.71))
orgp <- read.csv("~/Documents/Stats/PR2019/OrganicP.csv", header = TRUE, stringsAsFactors = TRUE, na.strings = "NA")
resinp.vol <- read.csv("~/Documents/Stats/PR2019/PR2019_resinp_vol.csv", header = TRUE, stringsAsFactors = TRUE, na.strings = "NA")
biom.corr <- read.csv("~/Documents/Stats/PR2019/BiomassCorrelations.csv", header = TRUE, stringsAsFactors = TRUE, na.strings = "NA")
pase.mat <- read.csv("~/Documents/Stats/PR2019/Mastersheet.csv", header = TRUE, stringsAsFactors = TRUE, na.strings = "NA")
sandsiltclay <- read.csv("~/Documents/Stats/PR2019/Sandsiltclay.csv", header = TRUE, stringsAsFactors = TRUE, na.strings = "NA")
rootp <- read.csv("~/Documents/Stats/PR2019/RootP_Pase.csv", header = TRUE, stringsAsFactors = TRUE, na.strings = "NA")
```

# Soil Phosphatase
Soil phosphatase decreases with depth consistently among all sites,. Contrary to our hypothesis, soil phosphatase activity in ICA-R and ICA-V were lower than El Verde sites, despite previous results indicating much lower levels of available phosphorus. Interestingly, when ICA-R and ICA-V are combined as they were in a previous study, we see the same trend, where Icacos has higher phosphatase activity than EVR and EVV. In addition, previous results have suggested that Valley sites have lower phosphatase activity, perhaps due to surface runoff of phosphorus. However, here the differences between Ridge and Valley sites are not pronounced.

```{r Soil pase boxplot}
# boxplot of soil pase by depth and site
soilpase.boxplot <- ggplot(data = soilpase, aes(x = Depth, y = SoilPase)) + geom_boxplot() + 
  facet_grid(. ~ Site) + scale_x_discrete(limits=c("0-5cm", "7-12cm", "15-20cm", "25-30cm", "45-50cm", "80-90cm")) +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1),
        axis.title.x = element_blank()) +
  ylab(expression(Soil~Phosphatase~(mu~pNP~g^{-1})))

pdf("soilpase_boxplot.pdf")
plot(soilpase.boxplot)
dev.off()
```

## Summary Statistics
```{r Soil Pase mean}
# soil pase by site and depth
soilpase.sum <- soilpase %>%
  group_by(Site, Depth) %>%
  summarise(n = n(),
            mean = mean(SoilPase, na.rm = TRUE),
            sd = sd(SoilPase, na.rm = TRUE),
            se = ((sd(SoilPase, na.rm = TRUE))/sqrt(n())))
write.csv(soilpase.sum, "table_soilpase_sitedepth.csv")

# soil pase by site
soilpase.sum2 <- soilpase %>%
  group_by(Site) %>%
  summarise(n = n(),
            mean = mean(SoilPase, na.rm = TRUE),
            sd = sd(SoilPase, na.rm = TRUE),
            se = ((sd(SoilPase, na.rm = TRUE))/sqrt(n())))
write.csv(soilpase.sum2, "table_soilpase_site.csv")

# soil pase barplot by site
soilpase_bar <- ggplot(data = soilpase.sum2, aes(x = Site, y = mean)) +
  geom_bar(stat = "identity", colour = "black") +
  geom_errorbar(aes(ymin = mean-se, ymax = mean+se), width = 0.2) +
  scale_y_continuous(limits = c(0, 10), breaks = c(0, 2, 4, 6, 8, 10)) +
  theme_bw() +
  theme(panel.grid = element_blank(),
        axis.title.x = element_blank()) +
  ylab(expression(Mean~soil~phosphatase~(mu~mol~pNP~gsoil^{-1})))

pdf("plot_soilpase_bar.pdf")
plot(soilpase_bar)
dev.off()


```

```{r Soil pase by depth}
soilpase.sum$Depth = factor(soilpase.sum$Depth, levels = c('0-5cm', '7-12cm', '15-20cm', '25-30cm', '45-50cm', '80-90cm'))

soilpase_point <- ggplot(data = soilpase.sum, aes(x = Depth, y = mean, colour = Site, group = Site)) + geom_point(size = 3) + geom_line(na.rm = FALSE) +
  scale_y_continuous(limits = c(0, 20), breaks = c(0, 5, 10, 15, 20)) +
  theme_bw() +
  theme(panel.grid = element_blank(),
        legend.position = c(0.9, 0.8)) +
  scale_colour_brewer(palette = "Set2") +
  xlab(expression(Soil~depth~(cm))) +
  ylab(expression(Mean~soil~phosphatase~(mu~mol~pNP~g~soil^{-1})))

pdf("plot_soilpase_point.pdf")
plot(soilpase_point)
dev.off()
```

## ANOVA
```{r Supplementary Table 2}
pase.rank <- rank(soilpase$SoilPase)
soilpase <- cbind(soilpase, pase.rank)

soilpase.aov <- aov(pase.rank ~ Site + Depth + Site:Depth, data = soilpase)
summary(soilpase.aov)
TukeyHSD(soilpase.aov)

# Site and Depth Letters
soilpase.x <- with(soilpase, interaction(Site, Depth))
soilpase.mod <- aov(pase.rank ~ soilpase.x, data = soilpase)
soilpase.out <- HSD.test(soilpase.mod, "soilpase.x", group = TRUE, alpha = 0.05)
print(soilpase.out)

# Site Letters
soilpase.site <- HSD.test(soilpase.aov, "Site", group = TRUE, alpha = 0.05)
print(soilpase.site)

# root biomass
pase.roootbiomass <- aov(SoilPase ~ FineRoot, data = soilpase)
summary(pase.roootbiomass) # not significant for total root only fine root

pase.vol.rootbiomass <- aov(SoilPase_vol ~ TotalRoot, data = soilpase)
summary(pase.vol.rootbiomass) # not sigificant for total root only fine root

ggplot(data = soilpase, aes(x = FineRoot, y = SoilPase_vol)) + geom_point() + geom_smooth(method = lm, se = FALSE, color = "black") + theme_bw() + theme(panel.grid = element_blank())

ggplot()

# equation
cor(soilpase$FineRoot, soilpase$SoilPase_vol, use = "complete.obs", method = "spearman") # 0.558

lm.mod <- lm(SoilPase_vol ~ FineRoot, data = soilpase)
print(lm.mod)
summary(lm.mod)
```

## Combined Icacos Plot
```{r Combined Icacos}
soilpase.mod <- read.csv("~/Documents/LabStats/PR2019/PR2019_PaseMod.csv", header = TRUE, na.strings = "NA", stringsAsFactors = TRUE)

pase.mod.sum <- soilpase.mod %>%
  group_by(Site, Depth) %>%
  summarise(n = n(),
            mean = mean(Pase, na.rm = TRUE),
            sd = sd(Pase, na.rm = TRUE),
            se = ((sd(Pase, na.rm = TRUE))/sqrt(n())))

ggplot(data = pase.mod.sum, aes(x = Depth, y = mean)) + geom_bar(stat = "identity") +
  geom_errorbar(aes(ymin = mean-se, ymax = mean+se), width = 0.2) + coord_flip() +
  facet_grid(. ~ Site) +
  scale_x_discrete(limits = rev(c("0-5cm", "7-12cm", "14-19cm", "27-32cm", "47-52cm", "87-92cm"))) +
  theme_bw() + theme(panel.grid = element_blank(),
                     axis.title.y = element_blank()) +  ylab(expression(Mean~Soil~Phosphatase~(mu~mol~pNP~g^{-1})))
```

# Paired Root and Soil Phosphatase
Root and soil phosphatase was analyzed using a two-way repeated measures MANOVA to determine whether phopshatase activity depended on whether it was measured from roots or soil and to discern differences in activity by site and depth. Root phosphatase and soil phosphatase, when standardized to soil volume were drastically different, with greater soil phsophatase than root phosphatase. Both differed among sites (p < 0.05), but not by depth (p = 0.98).

```{r boxplot pase per g}
# excluding these graphs but keeping the table version for comparison. 
# root pase per g root
ggplot(data = pairedpase, aes(x = Site, y = rootpase_groot, fill = Depth)) + geom_boxplot() +
  scale_y_continuous(limits = c(0, 200), breaks = c(0, 25, 50, 75, 100, 125, 150, 175, 200)) +
  scale_x_discrete(breaks = c("EVR", "EVV", "ICA-R", "ICA-V"),
                   labels = c("El Verde Ridge", "El Verde Valley", "Icacos-Ridge", "Icacos-Valley")) +
  theme_bw() +
  theme(panel.grid = element_blank(),
        legend.position = c(0.9,0.8),
        legend.background = element_rect(colour = "black"),
        axis.title.x = element_blank()) +
  scale_fill_brewer(palette = "Greys") + ylab(expression(Phosphatase~(mu~mol~pNP~g^{-1}~root)))

# soil pase per g soil
ggplot(data = pairedpase, aes(x = Site, y = soilpase_gsoil, fill = Depth)) + geom_boxplot() +
  scale_x_discrete(breaks = c("EVR", "EVV", "ICA-R", "ICA-V"),
                   labels = c("El Verde Ridge", "El Verde Valley", "Icacos-Ridge", "Icacos-Valley")) +
  scale_y_continuous(limits = c(0, 12), breaks = c(0, 2, 4, 6, 8, 10, 12)) +
  theme_bw() +
  theme(panel.grid = element_blank(),
        legend.position = c(0.9,0.8),
        legend.background = element_rect(colour = "black"),
        axis.title.x = element_blank()) +
  scale_fill_brewer(palette = "Greys") + ylab(expression(Phosphatase~(mu~mol~pNP~g^{-1}~soil)))
```

```{r Paired by volume}
# root pase by volume
paired.rootvol<- ggplot(data = pairedpase, aes(x = Site, y = rootpase_vol, fill = Depth)) + geom_boxplot() +
   scale_x_discrete(breaks = c("EVR", "EVV", "ICA-R", "ICA-V"),
                   labels = c("El Verde Ridge", "El Verde Valley", "Icacos-Ridge", "Icacos-Valley")) +
  scale_y_continuous(limits = c(0, 0.5), breaks = c(0, 0.1, 0.2, 0.3, 0.4, 0.5)) +
  theme_bw() +
  theme(panel.grid = element_blank(),
        legend.position = c(0.8,0.8),
        legend.background = element_rect(colour = "black"),
        axis.title.x = element_blank()) +
  scale_fill_brewer(palette = "Greys") +
  ylab(expression(Root~Phosphatase~(mu~mol~pNP~cm^{-3}~soil)))

pdf("plot_paired_rootvol.pdf")
plot(paired.rootvol)
dev.off()

# soil pase by volume
paired_soilvol <- ggplot(data = pairedpase, aes(x = Site, y = soilpase_vol, fill = Depth)) + geom_boxplot() +
   scale_x_discrete(breaks = c("EVR", "EVV", "ICA-R", "ICA-V"),
                   labels = c("El Verde Ridge", "El Verde Valley", "Icacos-Ridge", "Icacos-Valley")) +
  scale_y_continuous(limits = c(0, 20), breaks = c(0, 5, 10, 15, 20)) +
  theme_bw() +
  theme(panel.grid = element_blank(),
        legend.position = c(0.8,0.8),
        legend.background = element_rect(colour = "black"),
        axis.title.x = element_blank()) +
  scale_fill_brewer(palette = "Greys") +
  ylab(expression(Phosphatase~(mu~mol~pNP~cm^{-3}~soil)))

pdf("plot_paired_soilvol.pdf")
plot(paired_soilvol)
dev.off()
```

```{r Paired mean tables}

#paired by site and depth
pairedpase.sum <- pairedpase %>%
  dplyr::select(Site, Depth, rootpase_groot, rootpase_vol, soilpase_gsoil, soilpase_vol) %>%
  group_by(Site, Depth) %>%
  summarise_all(funs(mean, sd), na.rm = TRUE)
write.csv(pairedpase.sum, "table_pairedpase_sitedepth.csv")
View(pairedpase.sum)

# paired pase by site
library(plotrix)
pairedpase.sum2 <- pairedpase %>%
  select(Site, rootpase_groot, rootpase_vol, soilpase_gsoil, soilpase_vol) %>%
  group_by(Site) %>%
  summarise_all(funs(mean, sd, std.error), na.rm = TRUE)
write.csv(pairedpase.sum2, "table_pairedpase_site.csv")
View(pairedpase.sum2)

# barplot by site (averaged pase_vol depths)
# root pase
paired.rootbar <- ggplot(data = pairedpase.sum2, aes(x = Site, y = rootpase_vol_mean)) + 
  geom_bar(stat = "identity", colour = "black") +
  geom_errorbar(aes(ymin = rootpase_vol_mean-rootpase_vol_std.error, 
                    ymax =  rootpase_vol_mean+rootpase_vol_std.error), width = 0.2) +
  scale_y_continuous(limits = c(0, 0.20), breaks = c(0.0, 0.05, 0.10, 0.15, 0.20),
                     name = expression(Root~phosphatase~(mu~mol~pNP~cm^{-3}~soil))) +
  theme_bw() +
  theme(panel.grid = element_blank())

pdf("pairedpase_rootbar.pdf")
plot(paired.rootbar)
dev.off()

# soil pase
paired.soilbar <- ggplot(data = pairedpase.sum2, aes(x = Site, y = soilpase_vol_mean)) + 
  geom_bar(stat = "identity", colour = "black") +
  geom_errorbar(aes(ymin = soilpase_vol_mean-soilpase_vol_std.error, 
                    ymax =  soilpase_vol_mean+soilpase_vol_std.error), width = 0.2) +
  scale_y_continuous(limits = c(0, 20), breaks = c(0.0, 5.0, 10.0, 15.0, 20.0),
                     name = expression(Soil~phosphatase~(mu~mol~pNP~cm^{-3}~soil))) +
  theme_bw() +
  theme(panel.grid = element_blank())

pdf("pairedpase_soilbar.pdf")
plot(paired.soilbar)
dev.off()

```

## Two-way repeated measures MANOVA
```{r two way MANOVA}

# setting up dataframe for volume
pairedpase.manova <- pairedpase %>%
  dplyr::select(Site, Depth, rootpase_vol, soilpase_vol) %>%
  melt(id = c("Site", "Depth"))
View(pairedpase.manova)

# rank transforming data
pase.rank <- rank(pairedpase.manova$value)
pairedpase.manova <- cbind(pairedpase.manova, pase.rank)

ID <- rownames(pairedpase.manova)
pairedpase.manova <- cbind(id=ID, pairedpase.manova)

# establishing factors
pairedpase.manova <- within(pairedpase.manova, {
  Site <- factor(Site)
  Depth <- factor(Depth)
  variable <- factor(variable)
})

# ANOVA
pairedmanova.aov <- with(pairedpase.manova,
               aov(pase.rank ~ variable*Site*Depth + Error(id / (Site*Depth))))
summary(pairedmanova.aov)

# re-run as two way anova with site and variable as  factor
paired.aov <- aov(pase.rank ~ variable*Site, data = pairedpase.manova)
summary(paired.aov)
TukeyHSD(paired.aov)

# Site and Depth Letters
pairedpase.x <- with(pairedpase.manova, interaction(Site, variable))
pairedpase.mod <- aov(pase.rank ~ pairedpase.x, data = pairedpase.manova)
pairedpase.out <- HSD.test(pairedpase.mod, "pairedpase.x", group = TRUE, alpha = 0.05)
print(pairedpase.out)
```

## Surface Area
```{r SA summary}

# boxplot
rsa.box <- ggplot(data = pairedpase, aes(x = Site, y = surface.area, fill = Depth)) + geom_boxplot() +
  scale_y_continuous(limits = c(0, 80)) +
  theme_bw() +
  theme(panel.grid = element_blank(),
        axis.title.x = element_blank()) +
  scale_fill_brewer(palette = "Greys")

pdf("rsa_boxplot.pdf")
plot(rsa.box)
dev.off()

# rsa site and depth means
rsa.sum <- pairedpase %>%
  group_by(Site, Depth) %>%
  summarise(n = n(),
            mean = mean(surface.area, na.rm = TRUE),
            sd = sd(surface.area, na.rm = TRUE),
            se = std.error(surface.area, na.rm = TRUE))
write.csv(rsa.sum, "table_surfacearea_sitedepth.csv")


# barplot of surface area by depth and site
surfacearea.depthsite <- ggplot(data = rsa.sum, aes(x = Depth, y = mean)) +
  geom_bar(stat = "identity") + facet_grid(.~Site) +
  geom_errorbar(aes(ymin = mean-se, ymax = mean+se), width = 0.2) +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title.x = element_blank()) +
  ylab(expression(Mean~surface~area~(cm^{2})))

pdf("surfacearea_depthsite_bar.pdf")
plot(surfacearea.depthsite)
dev.off()

rsa.site <- pairedpase %>%
  group_by(Site) %>%
  summarise(n = n(),
            mean = mean(surface.area, na.rm = TRUE),
            sd = sd(surface.area, na.rm = TRUE),
            se = std.error(surface.area, na.rm = TRUE))
write.csv(rsa.site, "table_surfacearea_site.csv")

# barplot of surface area by site
surfacearea.site <- ggplot(data = rsa.site, aes(x = Site, y = mean)) +
  geom_bar(stat = "identity") +
  geom_errorbar(aes(ymin = mean-se, ymax = mean+se), width = 0.2) +
  theme_bw() +
  theme(panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        axis.title.x = element_blank()) +
  ylab(expression(Mean~surface~area~(cm^{2})))

pdf("surfacearea_site.pdf")
plot(surfacearea.site)
dev.off()
```

```{r SA anova}
# anova
rsa.aov <- aov(surface.area ~ Site*Depth, data = pairedpase)
summary(rsa.aov)

# normality
plot(rsa.aov, 2)
shapiro.test(pairedpase$surface.area) # normal

# homogeneity of variance
levene.test(surface.area ~ Site*Depth, data = pairedpase) # normal

# Site and Depth Letters
surfacearea.x <- with(pairedpase, interaction(Site, Depth))
surfacearea.mod <- aov(surface.area ~ surfacearea.x, data = pairedpase)
surfacearea.out <- HSD.test(surfacearea.mod, "surfacearea.x", group = TRUE, alpha = 0.05)
print(surfacearea.out)

# Site
sa.site.mod <- aov(surface.area ~ Site, data = pairedpase)
summary(sa.site.mod)

sa.site.out <- HSD.test(sa.site.mod, "Site", group = TRUE, alpha = 0.05)
print(sa.site.out)
```

```{r pase x SA}

# root x sa
root.sa <- ggplot(data = pairedpase, aes(x=surface.area, y=rootpase_vol)) + geom_point(alpha = 0.5) +
  geom_smooth(method = lm, se = FALSE, color = "black") +
  scale_x_continuous(limits = c(0, 80), breaks = c(0, 20, 40, 60, 80)) +
  scale_y_continuous(limits = c(0, 0.3), breaks = c(0, 0.1, 0.2, 0.3)) +
  theme_bw() +
  theme(panel.grid = element_blank()) +
  xlab(expression(Mean~surface~area~(cm^{2}))) +
  ylab(expression(Root~phosphatase~(mu~mol~pNP~cm^{-3}~soil)))

pdf("corr_root_sa.pdf")
plot(root.sa)
dev.off()

# equation
cor(pairedpase$surface.area, pairedpase$rootpase_vol, use = "complete.obs", method = "pearson") # 0.713

cor.test(pairedpase$surface.area, pairedpase$rootpase_vol, use = "complete.obs", method = "spearman")

lm.mod <- lm(rootpase_vol ~ surface.area, data = pairedpase)
print(lm.mod)
summary(lm.mod)

# soil pase from short core samples
ggplot(data = pairedpase, aes(x=surface.area, y=soilpase_vol)) + geom_point(alpha = 0.5) +
  geom_smooth(method = lm, se = FALSE, color = "black") +
  scale_x_continuous(limits = c(0, 80), breaks = c(0, 20, 40, 60, 80)) +
  scale_y_continuous(limits = c(0, 20), breaks = c(0, 5, 10, 15, 20)) +
  theme_bw() +
  theme(panel.grid = element_blank()) +
  xlab(expression(Surface~area~(cm^{2}))) +
  ylab(expression(Soil~phosphatase~(mu~mol~pNP~cm^{-3}~soil)))

View(pairedpase)

# equation
cor(pairedpase$surface.area, pairedpase$soilpase_vol, use = "complete.obs", method = "spearman") # 0.259

cor.test(pairedpase$surface.area, pairedpase$soilpase_vol, use = "complete.obs", method = "spearman")

lm.mod2 <- lm(soilpase_vol ~ surface.area, data = pairedpase)
print(lm.mod2)
summary(lm.mod2)
```


## Root Biomass
```{r root biomass x soil pase}

ggplot(data = pairedpase, aes(x = fineroot, y = soilpase_vol)) + geom_point() +
  geom_smooth(method = "lm", se = FALSE, colour = "black")

ggplot(data = pairedpase, aes(x = fineroot, y = rootpase_vol)) + geom_point() +
  geom_smooth(method = "lm", se = FALSE, colour = "black") +
  theme_bw() +
  theme(panel.grid = element_blank()) +
  scale_y_continuous(limits = c(0.0, 0.3)) +
  xlab(expression(Absorptive~root~biomass~(mg~root~cm^{-3}))) +
  ylab(expression(Root~phosphatase~(mu~mol~pnp~g^{-3})))
  

cor.test(pairedpase$fineroot, pairedpase$rootpase_vol, method = "spearman", use = "complete.obs")
```

## Root P
```{r}
ggplot(data = pairedpase, aes(x = rootpase_vol, y = rootp)) + geom_point() +
  geom_smooth(method = "lm", se = FALSE, colour = "black") +
  theme_bw() +
  theme(panel.grid = element_blank()) +
  scale_y_continuous(limits = c(0.0, 0.3)) +
  ylab(expression(Root~P~('%'))) +
  xlab(expression(Root~phosphatase~(mu~mol~pnp~g^{-3})))

cor.test(pairedpase$rootpase_vol, pairedpase$rootp, method = "spearman", use = "complete.obs")
```


# Resin P
An outlier test using Cooks Distance indicates that sample 19 (EVV Location 1: 0-5 cm) is a data point that significantly skews statistical models. In this case, sample 19 is 4 times the mean, suggesting that it should not be included. Phosphorus availability differed among sites (p < 0.001), but not by depth. Generally, El Verde sites contained more phosphorus than in Icacos sites and there weren't any consistent patterns of phosphorus availability by depth.

## Outlier Test
```{r Resin P Outlier}
# outlier test: Cook's D
mod <- lm(ResinP ~ Site, data = resinp)
cooksd <- cooks.distance(mod)

# plot Cook's D using 4/n
plot(cooksd, pch = "*", cex = 2, main = "Influential Obs by Cooks distance")
abline(h = 4/70, col="red")
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4/70, names(cooksd),""), col="red")

# replacing 19 (EVV Location 1 0-5cm)
resinp <- resinp %>%
  replace_with_na(replace = list(ResinP = 5.71))
```

## Summary Statistics
```{r Resin P boxplot}

resinp.boxplot <- ggplot(data = resinp, aes(x = SoilDepth, y = ResinP)) + geom_boxplot() + facet_grid(.~Site) +
  scale_x_discrete(limits = c("0-5cm", "7-12cm", "14-19cm", "27-32cm", "47-52cm", "87-92cm")) +
  scale_y_continuous(limits = c(0, 2.00)) +
  theme_bw() + theme(panel.grid = element_blank(),
                     axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1),
                     axis.title.x = element_blank()) +
  ylab(expression(Resin~P~(mu~g~P~g^{-1})))

pdf("resinp_boxplot.pdf")
plot(resinp.boxplot)
dev.off()
```

```{r resinp mean, sd,se}
# resin p mean, sd, se
resinp.sum <- resinp %>%
  group_by(Site, SoilDepth) %>%
  summarise(n = n(),
            mean = mean(ResinP, na.rm = TRUE),
            sd = sd(ResinP, na.rm = TRUE),
            se = std.error(ResinP, na.rm = TRUE))
write.csv(resinp.sum, "table_resinp_sitedepth.csv")

# resin p mean by site
resinp.sum2 <- resinp %>%
  group_by(Site) %>%
  summarise(n = n(),
            mean = mean(ResinP, na.rm = TRUE),
            sd = sd(ResinP, na.rm = TRUE),
            se = std.error(ResinP, na.rm = TRUE))
write.csv(resinp.sum2, "table_resinp_site.csv")

# resin p by site barplot
resinpsum.plot <- ggplot(data = resinp.sum2, aes(x = Site, y = mean)) + geom_bar(stat = "identity", colour = "black") +
  geom_errorbar(aes(ymax = mean+se, ymin = mean-se), width = 0.2) +
  scale_y_continuous(limits = c(0, 1.00)) +
  scale_colour_brewer(palette = "Set2") +
  theme_bw() + theme(panel.grid = element_blank(),
                     axis.text.x = element_text(hjust = 1, vjust = 1),
                     axis.title.x = element_blank()) +
  ylab(expression(Resin~P~(mu~g~P~g^{-1})))

pdf("plot_resinp_bar.pdf")
plot(resinpsum.plot)
dev.off()
```

```{r ave resinp by depth}

# geom_point resin p
resinp.sum$SoilDepth <- factor(resinp.sum$SoilDepth, levels = c('0-5cm', '7-12cm', '14-19cm', '27-32cm', '47-52cm', '87-92cm'))
View(resinp.sum)

resinp.point <- ggplot(data = resinp.sum, aes(x = SoilDepth, y = mean, colour = Site, group = Site)) +
  geom_point(size = 3) +
  geom_line(na.rm = FALSE) +
  scale_y_continuous(limits = c(0, 1.00)) +
  scale_colour_brewer(palette = "Set2") +
  theme_bw() + theme(panel.grid = element_blank(),
                     axis.text.x = element_text(hjust = 1, vjust = 1),
                     axis.title.x = element_blank(),
                     legend.position = c(0.9,0.8)) +
  ylab(expression(Phosphorus~availability~(mu~g~P~g^{-1})))

pdf("plot_resinp_point.pdf")
plot(resinp.point)
dev.off()

```

## ANOVA
```{r resinp anova}

# testing normality
ggqqplot(resinp$ResinP)
shapiro.test(resinp$ResinP) # not normal

# rank transform
rank.resin <- rank(resinp$ResinP)
resinp <- cbind(resinp, rank.resin)

rank.resin.aov <- aov(rank.resin ~ Site*SoilDepth, data = resinp)
summary(rank.resin.aov)

# Site and Depth Letters
tx <- with(resinp, interaction(Site, SoilDepth))
amod <- aov(rank.resin ~ tx, data = resinp)
out <- HSD.test(amod, "tx", group = TRUE, alpha = 0.05)
print(out)

# Site Letters
out2 <- HSD.test(rank.resin.aov, "Site", group = TRUE, alpha = 0.05)
print(out2)

```

# Organic P
Unlike resin P, there are stark differences in organic phosphorus content among the sites (p < 0.001) and depths (p < 0.01). In particular, both El Verde sites have significantly higher concentrations than in the Icacos sites. There was no significant interaction between site and depth in determining organic phosphorus, and the boxplot suggests that organic phosphorus tends to decrease until 25-30 cm before increasing slightly.
**double check with re-done values**

## Summary Statistics
```{r Organic P boxplot}
# organic P by depth and site
orgp.boxplot <- ggplot(data = orgp, aes(x = Depth, y = Total)) + geom_boxplot() +
  facet_grid(.~Site) + scale_x_discrete(limits = c("0 -5 cm", "7-12 cm", "15-20 cm", "25-30 cm", "45-50 cm", "80-90 cm")) + theme_bw() +
  theme(panel.grid = element_blank(),
        axis.text.x = element_text(angle = 30, hjust = 1, vjust = 1),
        axis.title.x = element_blank()) +
  ylab(expression(Total~organic~P~(mg~P~g^{-1})))

pdf("orgp_boxplot.pdf")
plot(orgp.boxplot)
dev.off()
```

```{r Organic P mean table}
# Total organic P by site and depth
orgp.sum <- orgp %>%
  group_by(Site, Depth) %>%
  summarise(n = n(),
            mean = mean(Total, na.rm = TRUE),
            sd = sd(Total, na.rm = TRUE),
            se = std.error(Total, na.rm = TRUE))
write.csv(orgp.sum, "orgp_sum.csv")

# total organic P by site
orgp.sum2 <- orgp %>%
  group_by(Site) %>%
  summarise(n = n(),
            mean = mean(Total, na.rm = TRUE),
            sd = sd(Total, na.rm = TRUE),
            se = std.error(Total, na.rm = TRUE))
write.csv(orgp.sum2, "orgp_sum_site.csv")

```

```{r Organic P summary plots}
orgp.sum$Depth <- factor(orgp.sum$Depth, levels = c('0 -5 cm', '7-12 cm', '15-20 cm', '25-30 cm', '45-50 cm', '80-90 cm'))
View(orgp.sum)

# point
orgp.point <- ggplot(data = orgp.sum, aes(x = Depth, y = mean, colour = Site, group = Site)) +
  geom_point(size = 3) +
  geom_line(na.rm = FALSE) +
  scale_y_continuous(limits = c(0, 1.00)) +
  scale_colour_brewer(palette = "Set2") +
  theme_bw() + theme(panel.grid = element_blank(),
                     axis.text.x = element_text(hjust = 1, vjust = 1),
                     axis.title.x = element_blank(),
                     legend.position = c(0.9,0.75)) +
  ylab(expression(Total~organic~P~(mg~P~g^{-1})))

pdf("orgp.pdf")
plot(orgp.point)
dev.off()

# bar
orgp.bar <- ggplot(data = orgp.sum2, aes(x = Site, y = mean)) +
  geom_bar(stat = "identity", colour = "black") +
  geom_errorbar(aes(ymin = mean-se, ymax = mean+se), width = 0.2) +
  scale_y_continuous(limits = c(0, 0.3)) +
  theme_bw() + theme(panel.grid = element_blank(),
                     axis.title.x = element_blank()) +
  ylab(expression(Mean~total~organic~P~(mg~P~g^{-1})))

pdf("orgp_bar.pdf")
plot(orgp.bar)
dev.off()

```

## ANOVA
```{r Supplementary Table 8}

# normality
ggqqplot(orgp$organicp_vol)
shapiro.test(orgp$organicp_vol) # not normal

# rank transform
rank.optotal <- rank(orgp$Total)
orgp <- cbind(orgp, rank.optotal)

rank.orgp.aov <- aov(rank.optotal ~ Site*Depth, data = orgp)
summary(rank.orgp.aov) # significant

# Site and Depth Letters
orgp.x <- with(orgp, interaction(Site, Depth))
orgp.mod <- aov(rank.optotal ~ orgp.x, data = orgp)
orgp.out <- HSD.test(orgp.mod, "orgp.x", group = TRUE, alpha = 0.05)
print(orgp.out)

# Site Letters
orgp.site <- HSD.test(rank.orgp.aov, "Site", group = TRUE, alpha = 0.05)
print(orgp.site)

# proof that lsmeans gets you same result
library(lsmeans)
library(car)
model.rankorgp <- lm(rank.optotal ~ Site + Depth + Site:Depth, data = orgp)
Anova(model.rankorgp, type = "II") # exactly the same as aov

lsmeans(model.rankorgp,
        pairwise ~ Site,
        adjust = "tukey")

lsmeans(model.rankorgp,
        pairwise ~ Depth,
        adjust = "tukey")
```

# Correlations
## Resin P x Soil Phosphatase
The relationship between resin P and soil phosphatase depends on site and depth. As depth increases, the separation among sites diminishes until after 27-32 cm where there is no differenc among sites in soil phosphtase and resin P availability. In general, the Icacos sites tend to have lower soil phosphatase and resin P availability, within each depth. Given similar levels of phosphorus, El Verde sites consistently have higher soil phosphatase activity.

```{r corr resin p x soilpase}

# per g soil
pase.corr <- cbind(soilpase, resinp$ResinP)
pase.corr <- pase.corr %>%
  select(Site, Location, Depth, Parent, SoilPase, 'resinp$ResinP')
View(pase.corr)

pase.corr$Depth = factor(pase.corr$Depth, levels = c('0-5cm', '7-12cm', '15-20cm', '25-30cm', '45-50cm', '80-90cm'))

ggplot(data = pase.corr, aes(x = resinp$ResinP, y = SoilPase)) +
  geom_point(aes(shape = Site, fill = Depth), alpha = 0.5, size=5) + scale_fill_brewer(palette = "Set2") +
  scale_shape_manual(values = c(21, 22, 23, 24)) +
  geom_smooth(method = lm, se = FALSE, color = "black") +
  theme_bw() +
  scale_y_continuous(limits = c(0, 20), breaks = c(0, 5, 10, 15, 20)) +
  theme(panel.grid = element_blank()) + xlab(expression(Phosphorus~availability~(mu~P~gsoil^{-1}))) +
  ylab(expression(Soil~Phosphatase~(mu~pNP~gsoil^{-1})))

# ellipse
ggscatter(pase.corr, x = "resinp$ResinP", y = "SoilPase",
          color = "Parent", shape = "Parent",
          ellipse = TRUE)

# producing the legend
corr.legend <- ggplot(data = pase.corr, aes(x = resinp$ResinP, y = SoilPase, shape = Site, color = Depth)) +
  geom_point(alpha = 0.5, size=5) +
  scale_color_brewer(palette = "Set2")

pdf("corr_legend.pdf")
plot(corr.legend)
dev.off()

resinp.vol <- resinp.vol %>%
  select(SampleID, BD, resinp_vol)

# per volume
corr.resinp.pase <- ggplot(data = mastersheet, aes(x = ResinP_vol, y = SoilPase_vol)) +
  geom_point(aes(shape = Site, fill = Depth), alpha = 0.5, size=5) + scale_fill_brewer(palette = "Set2") +
  scale_shape_manual(values = c(21, 22, 23, 24)) +
  geom_smooth(method = lm, se = FALSE, color = "black") +
  theme_bw() +
  scale_y_continuous(limits = c(0, 20), breaks = c(0, 5, 10, 15, 20)) +
  theme(panel.grid = element_blank()) +
  xlab(expression(Phosphorus~availability~(mu~P~cm^{-3}))) +
  ylab(expression(Soil~Phosphatase~(mu~pNP~cm^{-3})))

pdf("corr_resinp_pase.pdf")
plot(corr.resinp.pase)
dev.off()

# outlier test: Cook's D
mod <- lm(resinp_vol ~ SoilPase_vol, data = resinp.pase.vol)
cooksd <- cooks.distance(mod)

# plot Cook's D using 4/n
plot(cooksd, pch = "*", cex = 2, main = "Influential Obs by Cooks distance")
abline(h = 4/70, col="red")
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4/70, names(cooksd),""), col="red")

# replacing 19 (EVV Location 1 0-5cm)
resinp.pase.vol <- resinp.pase.vol %>%
  replace_with_na(replace = list(resinp_vol = 6.368))

# equation
cor(mastersheet$ResinP_vol, mastersheet$SoilPase_vol, use = "complete.obs", method = "spearman") # 0.003

res <- cor.test(mastersheet$ResinP_vol, mastersheet$SoilPase_vol, use = "complete.obs", method = "spearman")
res

lm.mod <- lm(SoilPase_vol ~ ResinP_vol, data = mastersheet)
print(lm.mod)
summary(lm.mod) # p = 0.08

```
Source: http://r-statistics.co/Linear-Regression.html => recheck this

## Organic P x Resin P
```{r organic P x resin P}

org.resin <- mastersheet %>%
  select(Site, Depth, Parent, ResinP_vol, Organicp_vol)
View(org.resin)

# note: manually fixed outlier, see previous code

org.resin$Depth = factor(org.resin$Depth, levels = c('0 -5 cm', '7-12 cm', '15-20 cm', '25-30 cm', '45-50 cm', '80-90 cm'))

corr.orgp.resinp <- ggplot(data = org.resin, aes(x = Organicp_vol, y = ResinP_vol)) +
  geom_point(aes(shape = Site, fill = Depth), alpha = 0.5, size = 4) + scale_fill_brewer(palette = "Set2") +
  scale_shape_manual(values = c(21, 22, 23, 24)) +
  geom_smooth(method = lm, se = FALSE, color = "black") +
  theme_bw() +
  scale_x_continuous(limits = c(0, 0.30), breaks = c(0.00, 0.10, 0.20, 0.30)) +
  scale_y_continuous(limits = c(0, 1), breaks = c(0.00, 0.25, 0.50, 0.75, 1.00)) +
  theme(panel.grid = element_blank()) +
  xlab(expression(Total~Organic~Phosphorus~(mg~P~cm^{-3}))) +
  ylab(expression(Resin~P~(mu~g~P~cm^{-3})))

pdf("corr_orgp_resinp.pdf")
plot(corr.orgp.resinp)
dev.off()

# parent material
ggscatter(org.resin, x = "Organicp_vol", y = "ResinP_vol",
          color = "Parent", shape = "Parent",
          ellipse = TRUE)

# NOTE: tested normality. both x and y are non-normal
# must use non parametric spearman test
cor(org.resin$Organicp_vol, org.resin$ResinP_vol, method = "spearman", use = "complete.obs") # 0.61

# linear model
orgp.resinp.mod <- lm(ResinP_vol ~ Organicp_vol, data = org.resin)
coefficients(orgp.resinp.mod) # same as print()
summary(orgp.resinp.mod) # 0.269; multiple r squared what is difference between that and adjustred r squared
# also gives p value which is < 0.05 so there is a relatiomship
plot(orgp.resinp.mod) # residuals look okay

```

## Organic P x Soil Phosphatase
The relationship between organic P and soil phosphatase mirrors that of resin P, where soil phosphatase and organic phosphorus consistently decline with depth and the differences between sites disappear after 25-30 cm in depth. For a given organic phosphorus concentration, there is generally higher soil phosphatase in El Verde Ridge. El Verde Valley and Icacos Ridge appear to have similar soil phosphatase activity, despite Icacos Ridge having consistently lower amounts of organic phosphorus. Icacos Valley tends to have both lower organic phosphorus content and soil phosphtatase.

```{r orgp x soilpase}
View(mastersheet)

mastersheet$Depth = factor(mastersheet$Depth, levels = c("0 -5 cm", "7-12 cm", "15-20 cm", "25-30 cm", "45-50 cm", "80-90 cm"))

corr.orgp.pase <- ggplot(data = mastersheet, aes(x = Organicp_vol, y = SoilPase_vol)) +
  geom_point(aes(shape = Site, fill = Depth), alpha = 0.5, size = 4) + scale_fill_brewer(palette = "Set2") +
  scale_shape_manual(values = c(21, 22, 23, 24)) +
  geom_smooth(method = lm, se = FALSE, color = "black") +
  theme_bw() +
  scale_x_continuous(limits = c(0, 0.30), breaks = c(0.00, 0.10, 0.20, 0.30)) +
  scale_y_continuous(limits = c(0, 20), breaks = c(0, 5, 10, 15, 20)) +
  theme(panel.grid = element_blank()) +
  xlab(expression(Total~Organic~Phosphorus~(mg~P~cm^{-3}))) +
  ylab(expression(Soil~Phosphatase~(mu~mol~pnp~cm^{-3})))

pdf("corr_orgp_pase.pdf")
plot(corr.orgp.pase)
dev.off()

# ellipse
ggscatter(mastersheet, x = "Organicp_vol", y = "SoilPase_vol",
          color = "Parent", shape = "Parent",
          ellipse = TRUE)

# getting equation
cor(mastersheet$Organicp_vol, mastersheet$SoilPase_vol, use = "complete.obs", method = "spearman") # 0.105

res <- cor.test(mastersheet$Organicp_vol,mastersheet$SoilPase_vol, method = "spearman")
res

# linear model
lm.mod3 <- lm(SoilPase_vol ~ Organicp_vol, data = mastersheet)
print(lm.mod3)
summary(lm.mod3)
```

## Root Biomass x soil pase
As expected, root biomass decreass with depth. Root biomass does not appear ot differ significantly among sites, consistently remaing within 0.001 g/cm3 - 0.002 g/cm3. However, soil phosphatase varies among sites, where despite similar amounts of root biomass;  El Verde Ridge is highest in soil phosphatase activity, followed by El Verde Valley and Icacos Ridge, with Icacos Valley having the lowest amounts.

Note: removed 5-7cm data because no corresponding resin p or phosphatase activity

```{r rootbiomass x pase}

corr.rootmass.pase <- ggplot(data = soilpase, aes(x = FineRoot, y = SoilPase_vol)) +
  geom_point(aes(shape = Site, fill = Depth), alpha = 0.5, size = 5) + scale_fill_brewer(palette = "Set2") +
  scale_shape_manual(values = c(21, 22, 23, 24)) +
  geom_smooth(method = lm, se = FALSE, color = "black") +
  theme_bw() +
  scale_y_continuous(limits = c(0, 20), breaks = c(0, 5, 10, 15, 20)) +
  theme(panel.grid = element_blank()) +
  guides(fill = FALSE, shape = FALSE) +
  xlab(expression(Fine~Root~Biomass~(mg~root~cm^{-3}))) +
  ylab(expression(Soil~Phosphatase~(mu~mol~pnp~cm^{-3})))

pdf("corr_rootmass_pase.pdf")
plot(corr.rootmass.pase)
dev.off()

# ellipse
ggscatter(mastersheet, x = "RootBiomass", y = "SoilPase_vol",
          color = "Parent", shape = "Parent",
          ellipse = TRUE)

# getting equation
cor(soilpase$FineRoot, soilpase$SoilPase_vol, use = "complete.obs", method = "spearman")

cor.test(soilpase$FineRoot,soilpase$SoilPase_vol, use = "complete.obs", method = "spearman")

# linear model
lm.mod4 <- lm(SoilPase_vol ~ RootBiomass, data = mastersheet)
print(lm.mod4)
summary(lm.mod4)
```

## Bulk density x soil pase
```{r}
corr.bulkdens.pase <- ggplot(data = mastersheet, aes(x = BulkDens, y = SoilPase_vol)) +
  geom_point(aes(shape = Site, fill = Depth), alpha = 0.5, size = 4) + scale_fill_brewer(palette = "Set2") +
  scale_shape_manual(values = c(21, 22, 23, 24)) +
  geom_smooth(method = lm, se = FALSE, color = "black") +
  theme_bw() +
  scale_y_continuous(limits = c(0, 20), breaks = c(0, 5, 10, 15, 20)) +
  theme(panel.grid = element_blank()) +
  xlab(expression(Bulk~density~(g~cm^{-3}))) +
  ylab(expression(Soil~Phosphatase~(mu~mol~pnp~cm^{-3})))

pdf("corr_bulkdens_pase.pdf")
plot(corr.bulkdens.pase)
dev.off()

# ellipse
ggscatter(mastersheet, x = "BulkDens", y = "SoilPase_vol",
          color = "Parent", shape = "Parent",
          ellipse = TRUE)

# getting correlation
cor(mastersheet$BulkDens, mastersheet$SoilPase_vol, use = "complete.obs", method = "spearman") # -0.329

cor.test(mastersheet$BulkDens, mastersheet$SoilPase_vol, use = "complete.obs", method = "spearman")

# linear model
mod.bulkdens.pase <- lm(SoilPase_vol ~ BulkDens, data = mastersheet)
print(mod.bulkdens.pase)
summary(mod.bulkdens.pase)
```

## Soil pase x rootP
```{r}
View(soilpase)

ggplot(data = soilpase, aes(x = SoilPase_vol, y = rootp)) + geom_point(alpha = 0.5) +
  scale_x_continuous(limits = c(0, 10), breaks = c(0, 2, 4, 6, 8, 10)) +
  geom_smooth(method = "lm", se = FALSE, colour = "black") +
  theme_bw() +
  theme(panel.grid = element_blank()) +
  xlab(expression(Soil~Phosphatase~(mu~mol~pnp~cm^{-3}))) +
  ylab(expression(Root~P~('%'))) 

# equation
cor.test(soilpase$SoilPase_vol, soilpase$rootp, method = "spearman", use = "complete.obs")

```

## Soil texture matrix
```{r}
texture <- mastersheet %>% 
  dplyr::select(Parent, SoilPase_vol, ResinP_vol, Organicp_vol, RootBiomass, Sand, Silt, Clay)

# outlier for soilpase volume - CooksD
mod <- lm(SoilPase_vol ~ Sand, data = texture)
cooksd <- cooks.distance(mod)

# plot Cook's D using 4/n
plot(cooksd, pch = "*", cex = 2, main = "Influential Obs by Cooks distance")
abline(h = 4/70, col="red")
text(x=1:length(cooksd)+1, y=cooksd, labels=ifelse(cooksd>4/70, names(cooksd),""), col="red")

# replacing 4 manually because naiar not working
texture[4, 2] = NA

library(reshape2)
texture.melt <- melt(texture, id = c("Parent", "SoilPase_vol", "ResinP_vol", "Organicp_vol", "RootBiomass"))
View(texture.melt)


# texture x pase
texture.pase <- ggplot(data = texture.melt, aes(x = value, y = SoilPase_vol)) + geom_point(aes(fill = Parent), colour = "black", pch = 21) +
  facet_grid(.~variable) +
  scale_fill_manual(values = c("white", "grey")) +
  theme_bw() +
  theme(aspect.ratio = 1,
        panel.grid = element_blank(),
        axis.title.x = element_blank())

pdf("texture_pase.pdf")
plot(texture.pase)
dev.off()

# texture x resin p
# run linear regression
texture.resinp <- ggplot(data = texture.melt, aes(x = value, y = ResinP_vol)) + geom_point(aes(fill = Parent), colour = "black", pch = 21) +
  facet_grid(.~variable) + 
  scale_fill_manual(values = c("white", "grey")) +
  theme_bw() +
  theme(aspect.ratio = 1,
        panel.grid = element_blank(),
        axis.title.x = element_blank())

pdf("texture_resinp.pdf")
plot(texture.resinp)
dev.off()

# texture x organic p
texture.orgp <- ggplot(data = texture.melt, aes(x = value, y = Organicp_vol)) + geom_point(aes(fill = Parent), colour = "black", pch = 21) +
  facet_grid(.~variable) + 
  scale_fill_manual(values = c("white", "grey")) +
  theme_bw() +
  theme(aspect.ratio = 1,
        panel.grid = element_blank(),
        axis.title.x = element_blank())

pdf("texture_orgp.pdf")
plot(texture.orgp)
dev.off()

# texture x root biomass
texture.root <- ggplot(data = texture.melt, aes(x = value, y = RootBiomass)) + geom_point(aes(fill = Parent), colour = "black", pch = 21) +
  facet_grid(.~variable) + 
  scale_fill_manual(values = c("white", "grey")) +
  theme_bw() +
  theme(aspect.ratio = 1,
        panel.grid = element_blank(),
        axis.title.x = element_blank())

pdf("texture_root.pdf")
plot(texture.root)
dev.off()


```

# Regression Analysis
```{r}
mastersheet <- read.csv("~/Documents/Stats/PR2019/Mastersheet.csv", header = TRUE, stringsAsFactors = TRUE, na.strings = "NA")
View(mastersheet)
str(mastersheet)

fit1 <- lm(SoilPase_vol ~ BulkDens + ResinP_vol + Organicp_vol + RootBiomass + Parent, data = mastersheet) # try stepwise?
summary(fit1)
coefficients(fit1)
anova(fit1)

```

# NMDS
Not really all that useful
```{r}

# fixing row names
rownames(mstest) <- mstest[,1]
mstest <- mstest[,-1]

library(magrittr)
library(MASS)

# computing MDS
mds <- mstest %>%
  dist() %>%
  isoMDS() %>%
  .$points %>%
  as_tibble()
colnames(mds) <- c("Dim.1", "Dim.2")

# plot
ggscatter(mds, x = "Dim.1", y = "Dim.2",
          label = rownames(mstest),
          size = 1,
          repel = TRUE)

# k-means clustering
clust <- kmeans(mds, 3)$cluster %>%
  as.factor()

mds <- mds %>%
  mutate(groups = clust)

ggscatter(mds, x = "Dim.1", y = "Dim.2",
          label = rownames(mstest),
          color = "groups",
          size = 1,
          ellipse = TRUE,
          repel = TRUE)
```

# Principal Component Analysis
```{r}
ms.all <- mastersheet %>%
  dplyr::select(Site, Depth, Parent, BulkDens, SoilPase_vol, ResinP_vol, Organicp_vol, RootBiomass, Sand, Silt, Clay)
ms.all <- ms.all[complete.cases(ms.all), ]
View(ms.all)

ms.quant <- ms.all %>%
  dplyr::select(BulkDens, SoilPase_vol, ResinP_vol, Organicp_vol, RootBiomass, Sand, Silt, Clay)
View(ms.quant)

# computing PCA
res.pca <- prcomp(ms.quant, scale = TRUE)

# eigenvalues (% of variances explained by each PC)
fviz_eig(res.pca)

# graph of individuals
fviz_pca_ind(res.pca,
             col.ind = "cos2", # quality of representation
             repel = TRUE)

# graph of variables
fviz_pca_var(res.pca,
             col.var = "contrib", # color by contribution to PC
             gradient.cols = c("#FF0000", "#F2AD00", "#5BBCD6"),
             repel = TRUE)

# biplot of variables and individuals - merge
pca.1 <- fviz_pca_biplot(res.pca, repel = TRUE,
                col.var = "contrib",
                gradient.cols = c("#FF0000", "#F2AD00", "#5BBCD6"),
                col.ind = "#696969",
                label = "var"
                )

pdf("pca_1.pdf")
plot(pca.1)
dev.off()


# getting hexadecimal colors
library(wesanderson)
wes_palette("Darjeeling1", 3, type = "continuous")
c(wes_palette("Darjeeling1", 3, type = "continuous"))

# coloring by group - merge
groups <- as.factor(ms.all$Parent[1:66])
pca.2 <- fviz_pca_ind(res.pca,
             col.ind = ms.all$Parent,
             palette = c("gray47",  "black"),
             addEllipses = TRUE,
             ellipse.type = "confidence",
             legend.title = "Parent Material",
             repel = TRUE,
             label = "none")

pdf("pca_2.pdf")
plot(pca.2)
dev.off()

# colors for site: c("#00AFBB",  "#FC4E07", "#696969", "#E7B800")

# pca info
var <- get_pca_var(res.pca) # getting results for variables

# quality of variable representation ( high cos2 = good representation)
head(var$cos2)

# contribution of variables to PCs
# variables that are correlated wtih PC1 and 2 are most important to explaining variation
head(var$contrib) # larger contirbution = best

# contributions of variables to PC1
fviz_contrib(res.pca, choice = "var", axes = 1, top = 10)

```

# SandSiltClay Spidergraph
Note: modifed EVR Rep3 to get standard deviations

Spider Graph
http://www.r-graph-gallery.com/142-basic-radar-chart/
https://www.r-graph-gallery.com/143-spider-chart-with-saveral-individuals/
```{r Spider Data and Summary}

# summary
sandsiltclay.sum <- sandsiltclay %>%
  group_by(Site, Depth) %>%
  summarise_all(funs(min, max, mean, sd))
View(sandsiltclay.sum)

# spider chart
library(plotly) Sp

p <- plot_ly(
  type = 'scatterpolar',
  fill = 'toself'
) %>%
  add_trace(
    r = c(21, 67, 54, 21),
    theta = c('Sand', 'Clay', 'Silt', 'Sand'),
    name = 'Site EVR'
  ) %>%
  add_trace(
    r = c(44, 54, 50, 44),
    theta = c('Sand', 'Clay', 'Silt', 'Sand'),
    name = "Site EVV"
  ) %>%
  add_trace(
    r = c(61, 32, 48, 61),
    theta = c('Sand', 'Clay', 'Silt', 'Sand'),
    name = "Site ICAR"
  ) %>%
  add_trace(
    r = c(74, 31, 66, 74),
    theta = c('Sand', 'Clay', 'Silt', 'Sand'),
    name = "Site ICAV"
  ) %>%
  layout(
    polar = list(
      radialaxis = list(
        visible = T,
        range = c(0, 80)
      )
    )
  )
```

